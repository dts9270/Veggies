<!doctype html>
<html lang="mr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DS Vegetable • Parbhani — Premium Organic UI</title>
  <meta name="description" content="DS Vegetable — Fresh fruits & vegetables delivery, Parbhani (Donhi). Premium organic UI.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6f7f4;
      --soft-green:#e8f7ee;
      --leaf-green:#2e7d57;
      --leaf-600:#2a6f4b;
      --accent:#4fbf73;
      --muted:#6d7a71;
      --card:#ffffff;
      --glass: rgba(255,255,255,0.6);
      --radius:14px;
      --maxw:1180px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans Devanagari',sans-serif;background:var(--bg);color:#223;}
    .wrap{max-width:var(--maxw);margin:28px auto;padding:16px}
    /* TOPBAR */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;background:linear-gradient(180deg,var(--soft-green),#f5faf5);border-radius:16px;padding:12px 16px;box-shadow:0 6px 20px rgba(44,72,56,0.06);border:1px solid rgba(16,70,49,0.06)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo-circle{width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#2d6f55,#3aa36f);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(30,100,60,0.12);border:2px solid rgba(255,255,255,0.6)}
    .logo-circle svg{width:34px;height:34px;fill:#fff}
    .brand h1{margin:0;font-size:1.05rem;color:var(--leaf-600)}
    .brand p{margin:0;font-size:0.78rem;color:var(--muted)}
    .top-actions{display:flex;align-items:center;gap:8px}
    .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .btn-ghost{background:transparent;border:1px solid rgba(34,34,34,0.06);color:var(--leaf-600)}
    .btn-primary{background:linear-gradient(90deg,var(--leaf-600),var(--accent));color:#06321f}
    .search{padding:8px 12px;border-radius:12px;border:1px solid rgba(34,34,34,0.04);min-width:220px}
    /* layout */
    .layout{display:grid;grid-template-columns:260px 1fr;gap:20px;margin-top:18px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} .sidebar{order:2} .hero{flex-direction:column-reverse;gap:12px} .search{min-width:120px} }
    /* sidebar */
    .sidebar{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(40,80,60,0.04)}
    .sidebar h3{margin:6px 0 8px 0;color:var(--leaf-600)}
    .cat{display:flex;flex-direction:column;gap:8px}
    .chip{padding:8px 10px;border-radius:999px;background:transparent;border:1px solid rgba(34,34,34,0.04);color:var(--leaf-600);cursor:pointer}
    /* hero */
    .hero{display:flex;align-items:center;justify-content:space-between;gap:12px;background:linear-gradient(180deg,#ffffff,rgba(255,255,255,0.96));padding:14px;border-radius:12px;box-shadow:0 10px 26px rgba(40,80,60,0.04)}
    .hero-left h2{margin:0;color:var(--leaf-600)}
    .hero-left p{margin:6px 0 0 0;color:var(--muted)}
    .hero-right img{width:180px;height:120px;border-radius:12px;object-fit:cover;box-shadow:0 12px 40px rgba(40,80,60,0.06)}
    /* grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
    @media (max-width:1000px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:600px){ .grid{grid-template-columns:1fr} .logo-circle{width:48px;height:48px} .hero-right img{width:120px;height:92px} }
    .product{background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(16,70,49,0.03);box-shadow:0 10px 30px rgba(15,60,40,0.03);transition:transform .18s ease}
    .product:hover{transform:translateY(-6px)}
    .media{height:120px;border-radius:10px;background:linear-gradient(180deg,#f7fff8,#f2faf2);display:flex;align-items:center;justify-content:center}
    .media img{max-height:100px;object-fit:contain}
    .p-title{font-weight:700;color:#234c3b;margin-top:10px}
    .p-meta{color:var(--muted);font-size:0.9rem}
    .p-row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:10px}
    .price{font-weight:800;color:var(--leaf-600)}
    .p-actions{display:flex;gap:8px;margin-top:12px;align-items:center}
    .qty{padding:8px;border-radius:8px;border:1px solid rgba(34,34,34,0.04);min-width:110px}
    .addbtn{background:var(--leaf-600);color:#fff;border-radius:10px;padding:10px 12px;border:none;cursor:pointer}
    /* floating cart */
    .cart-float{position:fixed;right:20px;bottom:18px;background:linear-gradient(90deg,#ffffff,#fbfff9);padding:12px;border-radius:12px;box-shadow:0 18px 42px rgba(20,60,40,0.12);display:flex;align-items:center;gap:12px;z-index:999}
    .cart-float .badge{background:var(--leaf-600);color:#fff;padding:6px 8px;border-radius:8px;font-weight:700}
    .cart-float .tot{font-weight:700;color:var(--leaf-600)}
    /* bottom cards */
    .row-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:18px}
    @media (max-width:900px){ .row-cards{grid-template-columns:repeat(1,1fr)} }
    .card-small{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 8px 24px rgba(10,50,30,0.04)}
    /* admin styles */
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:12px;border-bottom:1px solid rgba(20,60,40,0.04);text-align:left}
    .input{padding:8px;border-radius:8px;border:1px solid rgba(34,34,34,0.04);width:100%}
    /* small */
    .muted{color:var(--muted)}
    .center{display:flex;align-items:center;justify-content:center}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- top -->
    <div class="topbar">
      <div class="brand">
        <div class="logo-circle" aria-hidden="true">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2s-3 2-3 4 2 4 3 4 3-2 3-4-3-4-3-4zM4 13c0 3 4 7 8 7s8-4 8-7c0-3-3-5-7-5h-2c-4 0-7 2-7 5z"/></svg>
        </div>
        <div>
          <h1>DS VEGETABLE</h1>
          <p>Parbhani • Donhi — Fresh & Organic</p>
        </div>
      </div>

      <div class="top-actions">
        <input id="mainSearch" class="search" placeholder="उदा. टोमॅटो शोधा..." />
        <button class="btn btn-ghost" onclick="location.hash='#/delivery'">Delivery</button>
        <button class="btn btn-primary" onclick="location.hash='#/admin'">Admin</button>
      </div>
    </div>

    <!-- content placeholder -->
    <div id="contentArea" style="margin-top:18px"></div>
  </div>

  <!-- floating cart -->
  <div id="cartFloat" class="cart-float" style="display:none">
    <div>
      <div style="font-weight:700;color:#254f3c">तुमचा कार्ट</div>
      <div class="muted">टोटल • ₹<span id="cartTotal">0</span></div>
    </div>
    <div class="badge" id="cartCount">0</div>
    <div><button class="btn btn-primary" onclick="openCartDrawer()">पाहा</button></div>
  </div>

  <!-- CART DRAWER -->
  <div id="cartDrawer" style="position:fixed;right:18px;bottom:18px;width:360px;max-height:80vh;background:var(--card);border-radius:12px;padding:14px;box-shadow:0 18px 40px rgba(10,50,30,0.12);display:none;z-index:9999">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><strong>तुमचा कार्ट</strong><div class="muted" id="cartCountText"></div></div>
      <button onclick="closeCartDrawer()" class="btn btn-ghost">Close</button>
    </div>
    <div id="cartItems" style="margin-top:12px;overflow:auto;max-height:54vh"></div>
    <div style="border-top:1px solid rgba(20,60,40,0.04);padding-top:10px;margin-top:10px;display:flex;justify-content:space-between;align-items:center">
      <div>Total</div><div style="font-weight:800;color:var(--leaf-600)">₹<span id="cartTotalAmount">0</span></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn btn-primary" onclick="checkoutCOD()">Cash On Delivery</button>
      <button class="btn btn-ghost" onclick="checkoutWhats()">WhatsApp</button>
    </div>
  </div>

<script>
/* ---------------- Demo / Data ---------------- */
const ADMIN_DEMO = {user:'admin@ds', pass:'admin123'};
const DEL_DEMO = {user:'del1@ds', pass:'del123'};

const KEY = {PROD:'ds_prod_v3', ORD:'ds_ord_v3', DEL:'ds_del_v3', CART:'ds_cart_v3', SESSION:'ds_sess_v3'};

function seed(){
  if(!localStorage.getItem(KEY.PROD)){
    const p = [
      {id:1,name:'टोमॅटो (Fresh)',category:'भाजी',price:45,unit:'per kg',qty:60,image:''},
      {id:2,name:'कांदा (Local)',category:'भाजी',price:36,unit:'per kg',qty:90,image:''},
      {id:3,name:'केळी (Banana)',category:'फळ',price:95,unit:'per dozen',qty:40,image:''},
      {id:4,name:'पालक (Spinach)',category:'भाजी',price:22,unit:'per bunch',qty:55,image:''},
      {id:5,name:'बटाटा (Potato)',category:'भाजी',price:28,unit:'per kg',qty:150,image:''},
      {id:6,name:'सफरचंद (Apple)',category:'फळ',price:120,unit:'per kg',qty:30,image:''}
    ];
    localStorage.setItem(KEY.PROD, JSON.stringify(p));
  }
  if(!localStorage.getItem(KEY.ORD)) localStorage.setItem(KEY.ORD, JSON.stringify([]));
  if(!localStorage.getItem(KEY.DEL)) localStorage.setItem(KEY.DEL, JSON.stringify([{id:'del1',name:'Rahul',user:DEL_DEMO.user,pass:DEL_DEMO.pass,phone:'9000000001'}]));
  if(!localStorage.getItem(KEY.CART)) localStorage.setItem(KEY.CART, JSON.stringify([]));
}
seed();

/* helpers */
const getProducts = ()=> JSON.parse(localStorage.getItem(KEY.PROD)||'[]');
const saveProducts = (a)=> localStorage.setItem(KEY.PROD, JSON.stringify(a));
const getOrders = ()=> JSON.parse(localStorage.getItem(KEY.ORD)||'[]');
const saveOrders = (a)=> localStorage.setItem(KEY.ORD, JSON.stringify(a));
const getDelivery = ()=> JSON.parse(localStorage.getItem(KEY.DEL)||'[]');
const saveDelivery = (a)=> localStorage.setItem(KEY.DEL, JSON.stringify(a));
const getCart = ()=> JSON.parse(localStorage.getItem(KEY.CART)||'[]');
const saveCart = (a)=> localStorage.setItem(KEY.CART, JSON.stringify(a));
const setSession = s=> localStorage.setItem(KEY.SESSION, JSON.stringify(s));
const getSession = ()=> JSON.parse(localStorage.getItem(KEY.SESSION)||'null');
const clearSession = ()=> localStorage.removeItem(KEY.SESSION);
const uid = ()=> Date.now() + Math.floor(Math.random()*999);

/* routing */
window.addEventListener('hashchange', renderRoute);
window.addEventListener('load', renderRoute);
document.getElementById('mainSearch').addEventListener('input', (e)=> { if(location.hash==='#/') renderHome(e.target.value.trim()); });

function renderRoute(){
  const h = location.hash || '#/';
  if(h.startsWith('#/admin')) {
    const s = getSession(); if(!s || s.role!=='admin'){ renderAdminLogin(); } else { renderAdmin(); }
  } else if(h.startsWith('#/delivery')) {
    const s = getSession(); if(!s || s.role!=='delivery'){ renderDeliveryLogin(); } else { renderDelivery(); }
  } else {
    renderHome();
  }
}

/* ---------- HOME / USER UI ---------- */
function renderHome(q=''){
  const area = document.getElementById('contentArea');
  area.innerHTML = `
    <div class="layout">
      <aside class="sidebar">
        <h3>कॅटेगरी</h3>
        <div class="cat">
          <button class="chip" onclick="filterAll()">सर्व</button>
          <button class="chip" onclick="filterCat('भाजी')">भाजी</button>
          <button class="chip" onclick="filterCat('फळ')">फळे</button>
          <button class="chip" onclick="filterOffers()">ऑफर्स</button>
        </div>
        <div style="margin-top:12px" class="muted">डिलिव्हरी क्षेत्र: Parbhani City (Donhi)</div>
        <div style="margin-top:12px">
          <div class="muted">तुमचा स्टोअर</div><strong>DS VEGETABLE</strong>
        </div>
      </aside>

      <main>
        <div class="hero">
          <div class="hero-left">
            <h2>Fresh from Farm</h2>
            <p>आजच्या ताज्या फळा व भाज्या — Parbhani मधून घरपोच</p>
          </div>
          <div class="hero-right"><img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=5b8ad3b3c4f8bbf6b2ae6f0f6c3f3b77" alt="veg"></div>
        </div>

        <div id="grid" class="grid"></div>

        <div class="row-cards" style="margin-top:18px">
          <div class="card-small"><strong>Free delivery</strong><div class="muted">₹500 पेक्षा वरचे ऑर्डर फ्री</div></div>
          <div class="card-small"><strong>Daily fresh</strong><div class="muted">Market-fresh every morning</div></div>
          <div class="card-small"><strong>Support</strong><div class="muted">WhatsApp: 91XXXXXXXXXX</div></div>
        </div>
      </main>
    </div>
  `;
  renderProducts(q);
  renderCartFloat();
}

function renderProducts(q=''){
  const grid = document.getElementById('grid');
  const prods = getProducts().filter(p => !q || p.name.includes(q) || p.category.includes(q));
  grid.innerHTML = '';
  prods.forEach(p=>{
    const el = document.createElement('div'); el.className='product card';
    el.innerHTML = `
      <div class="media"><img src="${p.image || 'https://img.icons8.com/fluency/96/vegetarian-food.png'}" alt=""></div>
      <div class="p-title">${p.name}</div>
      <div class="p-meta">${p.category} • ${p.unit}</div>
      <div class="p-row">
        <div class="price">₹${p.price}</div>
      </div>
      <div class="p-actions">
        <input class="qty" placeholder="उदा. 1 kg" data-id="${p.id}">
        <button class="addbtn" data-id="${p.id}">Add</button>
      </div>
    `;
    grid.appendChild(el);
  });
  // attach add
  document.querySelectorAll('.addbtn').forEach(b=>{
    b.onclick = ()=>{
      const id = +b.dataset.id;
      const qtyEl = document.querySelector(`.qty[data-id="${id}"]`);
      const q = qtyEl.value.trim(); if(!q){ alert('कृपया प्रमाण भरा'); return; }
      const prod = getProducts().find(x=>x.id===id);
      const cart = getCart();
      cart.push({id:prod.id,name:prod.name,qtyText:q,price:prod.price});
      saveCart(cart); renderCartFloat(); qtyEl.value='';
      b.innerText='Added ✓'; setTimeout(()=> b.innerText='Add',800);
    };
  });
}

function filterAll(){ renderProducts(); }
function filterCat(cat){ const list = getProducts().filter(p=>p.category===cat); const grid = document.getElementById('grid'); grid.innerHTML=''; list.forEach(p=>{ const el = document.createElement('div'); el.className='product card'; el.innerHTML = `<div class="media"><img src="${p.image || 'https://img.icons8.com/fluency/96/vegetarian-food.png'}"></div><div class="p-title">${p.name}</div><div class="p-meta">${p.category} • ${p.unit}</div><div class="p-row"><div class="price">₹${p.price}</div></div><div class="p-actions"><input class="qty" placeholder=\"उदा. 1 kg\" data-id="${p.id}"><button class="addbtn" data-id="${p.id}">Add</button></div>`; grid.appendChild(el); }); document.querySelectorAll('.addbtn').forEach(b=> b.onclick = ()=> {const id=+b.dataset.id; const q=document.querySelector(`.qty[data-id="${id}"]`).value.trim(); if(!q){alert('प्रमाण भरा');return;} const prod=getProducts().find(x=>x.id===id); const c=getCart(); c.push({id:prod.id,name:prod.name,qtyText:q,price:prod.price}); saveCart(c); renderCartFloat();});
}
function filterOffers(){ alert('Offers: Coming soon'); }

/* cart UI */
function renderCartFloat(){
  const cart = getCart();
  const tot = cart.reduce((s,i)=> s + Number(i.price||0), 0);
  const cnt = cart.length;
  if(cnt>0){ document.getElementById('cartFloat').style.display='flex'; document.getElementById('cartTotal').innerText = tot; document.getElementById('cartCount').innerText = cnt; }
  else document.getElementById('cartFloat').style.display='none';
}
function openCartDrawer(){
  const d = document.getElementById('cartDrawer'); d.style.display='block';
  const items = getCart();
  const wrap = document.getElementById('cartItems'); wrap.innerHTML = '';
  if(!items.length){ wrap.innerHTML = '<div class="muted">कार्ट रिकामा आहे</div>'; document.getElementById('cartTotalAmount').innerText=0; return; }
  let subtotal = 0;
  items.forEach((it, idx) => {
    subtotal += Number(it.price||0);
    const row = document.createElement('div'); row.style.marginBottom='10px'; row.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${it.name}</strong><div class="muted">${it.qtyText}</div></div><div>₹${it.price}<div style="margin-top:6px"><button class="btn btn-ghost" onclick="removeCart(${idx})">Remove</button></div></div></div>`;
    wrap.appendChild(row);
  });
  document.getElementById('cartTotalAmount').innerText = subtotal;
  document.getElementById('cartCountText').innerText = `${items.length} items`;
}
function closeCartDrawer(){ document.getElementById('cartDrawer').style.display='none'; }
function removeCart(i){ const c = getCart(); c.splice(i,1); saveCart(c); openCartDrawer(); renderCartFloat(); }

/* checkout */
function checkoutCOD(){
  const items = getCart(); if(!items.length){ alert('कार्ट रिकामा आहे'); return; }
  const name = prompt('नाव टाका'); const phone = prompt('फोन नंबर'); const addr = prompt('पत्ता (Parbhani मध्ये)');
  if(!name||!phone||!addr){ alert('सर्व माहिती भरा'); return; }
  const subtotal = items.reduce((s,i)=> s + Number(i.price||0), 0);
  const delivery = subtotal >= 500 ? 0 : 20;
  const ord = {id: uid(), customer:{name,phone,addr}, items, subtotal, delivery, total: subtotal+delivery, status:'pending', placedAt: Date.now(), assignedTo:null};
  const orders = getOrders(); orders.push(ord); saveOrders(orders);
  saveCart([]); renderCartFloat(); closeCartDrawer();
  alert('ऑर्डर गया (Cash on Delivery). आम्ही लवकरच संपर्क करू.');
}
function checkoutWhats(){
  const items = getCart(); if(!items.length){ alert('कार्ट रिकामा आहे'); return; }
  let msg = '*DS Vegetable Order*%0A%0A';
  items.forEach(it => msg += `${it.name} — ${it.qtyText} — ₹${it.price}%0A`);
  const merchant = '91XXXXXXXXXX';
  window.open(`https://wa.me/${merchant}?text=${encodeURIComponent(msg)}`, '_blank');
}

/* ---------- ADMIN ---------- */
function renderAdminLogin(){
  const area = document.getElementById('contentArea');
  area.innerHTML = `<div style="max-width:560px;margin:24px auto" class="card"><div style="padding:16px"><h3>Admin Login</h3><div class="muted">Demo user: ${ADMIN_DEMO.user} / ${ADMIN_DEMO.pass}</div><div style="margin-top:12px"><input id="admUser" class="input" placeholder="Username"><input id="admPass" class="input" placeholder="Password" style="margin-top:8px"></div><div style="margin-top:12px;display:flex;gap:8px"><button class="btn btn-primary" id="admLoginBtn">Login</button><button class="btn btn-ghost" onclick="location.hash='#/'">Back</button></div></div></div>`;
  document.getElementById('admLoginBtn').addEventListener('click', ()=>{
    const u = document.getElementById('admUser').value.trim(); const p = document.getElementById('admPass').value.trim();
    if(u===ADMIN_DEMO.user && p===ADMIN_DEMO.pass){ setSession({role:'admin',user:u}); location.hash='#/admin'; renderRoute(); } else alert('Invalid credentials');
  });
}

function renderAdmin(){
  const area = document.getElementById('contentArea');
  const prods = getProducts(); const orders = getOrders(); const dels = getDelivery();
  area.innerHTML = `<div class="layout"><aside class="sidebar card"><h3>Admin Panel</h3><div class="muted">Manage your store</div><div style="margin-top:12px"><button class="chip" onclick="adminView('dashboard')">Dashboard</button><button class="chip" onclick="adminView('products')">Products</button><button class="chip" onclick="adminView('orders')">Orders</button><button class="chip" onclick="adminView('delivery')">Delivery Boys</button><div style="margin-top:12px"><button class="btn btn-ghost" onclick="adminLogout()">Logout</button></div></div></aside><main id="adminMain"></main></div>`;
  adminView('dashboard');
}

function adminView(page){
  const main = document.getElementById('adminMain');
  if(page==='dashboard'){
    const p = getProducts(); const o = getOrders(); const d = getDelivery();
    main.innerHTML = `<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px"><div class="card-small"><div class="muted">Total Orders</div><h3>${o.length}</h3></div><div class="card-small"><div class="muted">Products</div><h3>${p.length}</h3></div><div class="card-small"><div class="muted">Delivery Boys</div><h3>${d.length}</h3></div></div><div style="margin-top:12px"><h4>Recent Orders</h4><div id="admRecent"></div></div>`;
    const rr = getOrders().slice().reverse().slice(0,5); const list = document.getElementById('admRecent'); list.innerHTML = ''; rr.forEach(o=> { const el = document.createElement('div'); el.className='card'; el.style.marginBottom='8px'; el.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>Order #${o.id}</strong><div class="muted">${o.customer.name} • ${o.customer.phone}</div></div><div>₹${o.total}</div></div>`; list.appendChild(el); });
  } else if(page==='products'){
    const prod = getProducts(); main.innerHTML = `<div><h4>Products <button class="btn btn-primary" onclick="showAddProduct()">Add</button></h4><div id="prodTable"></div></div>`;
    const t = document.getElementById('prodTable'); t.innerHTML=''; prod.forEach(p=>{ const row = document.createElement('div'); row.className='card'; row.style.marginBottom='8px'; row.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${p.name}</strong><div class="muted">${p.category} • ${p.unit} • Stock: ${p.qty}</div></div><div><div style="font-weight:800;color:var(--leaf-600)">₹${p.price}</div><div style="margin-top:8px"><button class="btn btn-ghost" onclick="deleteProduct(${p.id})">Delete</button></div></div></div>`; t.appendChild(row); });
  } else if(page==='orders'){
    const orders = getOrders(); main.innerHTML = `<div><h4>All Orders</h4><div id="ordersList"></div></div>`; const ol = document.getElementById('ordersList'); ol.innerHTML=''; orders.slice().reverse().forEach(o=>{ const r = document.createElement('div'); r.className='card'; r.style.marginBottom='8px'; r.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>Order #${o.id}</strong><div class="muted">${o.customer.name} • ${o.customer.phone}</div></div><div>₹${o.total}</div></div><div style="margin-top:8px">${o.items.map(i=>`<div class="muted-2">${i.name} — ${i.qtyText}</div>`).join('')}</div><div style="margin-top:8px;display:flex;gap:8px"><select onchange="assignDelivery(${o.id},this.value)"><option value=''>Assign</option>${getDelivery().map(d=>`<option value="${d.id}">${d.name}</option>`).join('')}</select><select onchange="changeOrderStatus(${o.id},this.value)"><option value="pending" ${o.status==='pending'?'selected':''}>pending</option><option value="packed" ${o.status==='packed'?'selected':''}>packed</option><option value="out_for_delivery" ${o.status==='out_for_delivery'?'selected':''}>out_for_delivery</option><option value="delivered" ${o.status==='delivered'?'selected':''}>delivered</option></select></div>`; ol.appendChild(r); });
  } else if(page==='delivery'){
    const dels = getDelivery(); main.innerHTML = `<div><h4>Delivery Boys <button class="btn btn-primary" onclick="addDeliveryBoy()">Add</button></h4><div id="dlist"></div></div>`; const dl = document.getElementById('dlist'); dl.innerHTML=''; dels.forEach(d=>{ const r=document.createElement('div'); r.className='card'; r.style.marginBottom='8px'; r.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${d.name}</strong><div class="muted">${d.phone} • ${d.user}</div></div><div><button class="btn btn-ghost" onclick="removeDelivery('${d.id}')">Delete</button></div></div>`; dl.appendChild(r); });
  }
}

function adminLogout(){ clearSession(); location.hash='#/'; renderRoute(); }
function showAddProduct(){
  const name = prompt('नाव'); if(!name) return; const price = Number(prompt('किंमत'))||0; const cat = prompt('कॅटेगरी (भाजी/फळ)')||'भाजी'; const unit = prompt('युनिट (per kg)')||'per kg'; const qty = Number(prompt('स्टॉक'))||0;
  const arr = getProducts(); arr.push({id:uid(),name,category:cat,price,unit,qty,image:''}); saveProducts(arr); adminView('products');
}
function deleteProduct(id){ if(!confirm('Delete?')) return; let arr = getProducts(); arr = arr.filter(p=>p.id!==id); saveProducts(arr); adminView('products'); }
function assignDelivery(orderId, delId){ const arr = getOrders(); const idx = arr.findIndex(o=>o.id===orderId); if(idx>=0){ arr[idx].assignedTo = delId||null; saveOrders(arr); alert('Assigned'); } }
function changeOrderStatus(orderId, status){ const arr = getOrders(); const idx = arr.findIndex(o=>o.id===orderId); if(idx>=0){ arr[idx].status = status; saveOrders(arr); alert('Status updated'); } }
function addDeliveryBoy(){ const name=prompt('नाव'); const phone=prompt('फोन'); const user=prompt('username'); const pass=prompt('password'); if(!name||!user) return; const arr=getDelivery(); arr.push({id:uid().toString(),name,phone,user,pass}); saveDelivery(arr); adminView('delivery'); }
function removeDelivery(id){ let arr = getDelivery(); arr = arr.filter(d=>d.id!==id); saveDelivery(arr); adminView('delivery'); }

/* ---------- DELIVERY ---------- */
function renderDeliveryLogin(){
  const area = document.getElementById('contentArea');
  area.innerHTML = `<div style="max-width:520px;margin:32px auto" class="card"><div style="padding:16px"><h3>Delivery Login</h3><div class="muted">Demo: ${DEL_DEMO.user} / ${DEL_DEMO.pass}</div><div style="margin-top:12px"><input id="dUser" class="input" placeholder="Username"><input id="dPass" class="input" placeholder="Password" style="margin-top:8px"></div><div style="margin-top:12px"><button class="btn btn-primary" id="dLogin">Login</button> <button class="btn btn-ghost" onclick="location.hash='#/'">Back</button></div></div></div>`;
  document.getElementById('dLogin').addEventListener('click', ()=>{
    const u=document.getElementById('dUser').value.trim(), p=document.getElementById('dPass').value.trim();
    const db = getDelivery(); const match = db.find(x=> x.user===u && x.pass===p);
    if(match){ setSession({role:'delivery', id:match.id, name:match.name}); location.hash='#/delivery'; renderRoute(); } else alert('Invalid');
  });
}
function renderDelivery(){
  const s = getSession(); const id = s && s.id;
  const arr = getOrders().filter(o=> o.assignedTo === id);
  const area = document.getElementById('contentArea');
  area.innerHTML = `<div class="layout"><aside class="sidebar card"><h3>Delivery</h3><div class="muted">Welcome, ${s.name}</div><div style="margin-top:12px"><button class="chip" onclick="location.hash='#/delivery'">Assigned</button><button class="chip" onclick="location.hash='#/delivery/profile'">Profile</button><div style="margin-top:12px"><button class="btn btn-ghost" onclick="deliveryLogout()">Logout</button></div></div></aside><main><h3>Assigned Orders</h3><div id="assList"></div></main></div>`;
  const list = document.getElementById('assList'); list.innerHTML=''; if(!arr.length) list.innerHTML='<div class="muted">कोणतीही assigned order नाही</div>';
  arr.forEach(o=>{ const r=document.createElement('div'); r.className='card'; r.style.marginBottom='8px'; r.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>Order #${o.id}</strong><div class="muted">${o.customer.name} • ${o.customer.phone}</div></div><div>₹${o.total}</div></div><div style="margin-top:8px">${o.items.map(i=>`<div class="muted-2">${i.name} — ${i.qtyText}</div>`).join('')}</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn btn-primary" onclick="delAction(${o.id},'picked')">Picked</button><button class="btn btn-ghost" onclick="delAction(${o.id},'otw')">On the way</button><button class="btn btn-ghost" onclick="delAction(${o.id},'delivered')">Delivered</button></div>`; list.appendChild(r); });
}
function delAction(orderId, act){
  const arr = getOrders(); const idx = arr.findIndex(o=>o.id===orderId); if(idx>=0){
    if(act==='picked') arr[idx].status='packed';
    if(act==='otw') arr[idx].status='out_for_delivery';
    if(act==='delivered') arr[idx].status='delivered';
    saveOrders(arr); alert('Status updated'); renderRoute();
  }
}
function deliveryLogout(){ clearSession(); location.hash='#/'; renderRoute(); }

/* init */
renderRoute();
renderCartFloat();

/* expose debug */
window.ds = {getProducts, getOrders, getDelivery, getCart, saveProducts, saveOrders, saveDelivery, saveCart};
</script>
</body>
</html>
